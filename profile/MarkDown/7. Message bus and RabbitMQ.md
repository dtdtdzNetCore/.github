# 7. 메세지 버스와 RabbitMQ
- RabbitMQ는 메시지 브로커로, 생산자(Producer)가 보낸 메시지를 소비자(Consumer)가 받아갈 수 있도록 큐(queue)에 저장합니다.
- Exchange를 사용하여 라우팅 기능을 추가할 수 있습니다.
- AMQP(Advanced Message Queuing Protocol) 및 기타 프로토콜을 사용합니다.
## Exchage 유형
- Direct Exchange
  - 메시지를 하나의 큐로 전달합니다.
  - 라우팅 키를 사용하여 설정된 키가 일치하는 큐로 메시지를 전달합니다.
- Fanout Exchange
  - 모든 큐에 메시지를 전달합니다.
  - 여러 서비스나 소비자가 동일한 메시지를 동시에 처리해야할때 사용합니다.
- Topic Exchange
  - 패턴 매칭을 통해 메시지를 여러 큐로 전달합니다.
  - 라우팅키에 와일드 카드 패턴형태를 사용하고, 여러큐가 동일한 메시지를 수신할 수 있습니다.
- Header Exchange
  - 메시지의 헤더 값에 따라 큐로 메시지를 전달합니다.
  - 더 복잡한 라우팅 로직이 필요한 경우 사용합니다.
## 쿠버네티스에 RabbitMQ 배포하기
- `K8S\rabbitmq-depl.yaml`
    ```yaml
    apiVersion: apps/v1
    kind: Deployment
    metadata:
    name: rabbitmq-depl
    spec:
    replicas: 1
    selector:
        matchLabels:
        app: rabbitmq
    template:
        metadata:
        labels:
            app: rabbitmq
        spec:
        containers:
        - name: rabbitmq
            image: rabbitmq:3-management
            ports:
            - containerPort: 15672
            name: rbmq-mgmt-port
            - containerPort: 5672
            name: rbmq-msq-port
    ---
    apiVersion: v1
    kind: Service
    metadata:
    name: rabbitmq-clusterip-srv
    spec:
    type: ClusterIP
    selector:
        app: rabbitmq
    ports:
    - name: bmq-mgmt-port
        protocol: TCP
        port: 15672
        targetPort: 15672
    - name: rbmq-msg-port
        protocol: TCP
        port: 5672
        targetPort: 5672
    ---
    apiVersion: v1
    kind: Service
    metadata:
    name: rabbitmq-loadbalancer
    spec:
    type: LoadBalancer
    selector:
        app: rabbitmq
    ports:
    - name: rbmq-mgmt-port
        protocol: TCP
        port: 15672
        targetPort: 15672
    - name: rbmq-msg-port
        protocol: TCP
        port: 5672
        targetPort: 5672
    ```
- `kubectl apply -f rabbitmq-depl.yaml`으로 적용시킨다.
- rabbitmq를 확인하기 위해 브라우저에서 `http://localhost:15672`로 접근해본다.
  - `id:guest, password:guest`로 접근한다.